<!doctype html>
<html lang="pt-br">
<meta charset="utf-8">
<title>Gerador – Folha 40×40 (metade esquerda correta)</title>
<style>
  body{font-family:system-ui;margin:20px}
  .wrap{max-width:1200px;margin:auto}
  .controls{display:flex;gap:8px;flex-wrap:wrap;margin-bottom:12px}
  button{padding:8px 12px;border-radius:8px;border:1px solid #bbb;background:#fff;cursor:pointer}
  svg{border:1px solid #bbb;border-radius:12px;background:#fff}
  small{color:#555}
</style>
<div class="wrap">
  <h1>Gerador – 20×20 células, 40×40 px (alvo 50/50)</h1>
  <div class="controls">
    <button id="regen">Regerar</button>
    <button id="download">Baixar SVG</button>
    <small>Contagem por linha: 7,5,7,5,… | Bordas com stroke fixo</small>
  </div>

  <svg width="0" height="0" style="position:absolute;left:-9999px;top:-9999px">
    <defs>
      <symbol id="frame" viewBox="0 0 40 40">
        <rect x="1" y="1" width="38" height="38" fill="none" stroke="black" stroke-width="2" vector-effect="non-scaling-stroke"/>
      </symbol>
      <symbol id="target" viewBox="0 0 40 40">
        <rect x="20" y="0" width="20" height="40" fill="white"/>
        <rect x="0"  y="0" width="20" height="40" fill="black"/>
        <use href="#frame"/>
      </symbol>
      <symbol id="bar-right" viewBox="0 0 40 40">
        <rect x="0"  y="0" width="20" height="40" fill="white"/>
        <rect x="20" y="0" width="20" height="40" fill="black"/>
        <use href="#frame"/>
      </symbol>
      <symbol id="bar-top" viewBox="0 0 40 40">
        <rect x="0" y="0" width="40" height="20" fill="black"/>
        <rect x="0" y="20" width="40" height="20" fill="white"/>
        <use href="#frame"/>
      </symbol>
      <symbol id="bar-bottom" viewBox="0 0 40 40">
        <rect x="0" y="0" width="40" height="20" fill="white"/>
        <rect x="0" y="20" width="40" height="20" fill="black"/>
        <use href="#frame"/>
      </symbol>
      <symbol id="bar-center" viewBox="0 0 40 40">
        <rect x="0" y="0" width="40" height="40" fill="white"/>
        <rect x="14" y="0" width="12" height="40" fill="black"/>
        <use href="#frame"/>
      </symbol>
      <symbol id="diag-fwd" viewBox="0 0 40 40">
        <rect width="40" height="40" fill="white"/>
        <polygon points="0,0 40,0 0,40" fill="black"/>
        <use href="#frame"/>
      </symbol>
      <symbol id="diag-back" viewBox="0 0 40 40">
        <rect width="40" height="40" fill="white"/>
        <polygon points="40,0 40,40 0,40" fill="black"/>
        <use href="#frame"/>
      </symbol>
      <symbol id="tri-edges" viewBox="0 0 40 40">
        <rect width="40" height="40" fill="white"/>
        <polygon points="0,0 20,20 0,40" fill="black"/>
        <polygon points="40,0 20,20 40,40" fill="black"/>
        <use href="#frame"/>
      </symbol>
      <symbol id="top-and-right" viewBox="0 0 40 40">
        <rect width="40" height="40" fill="white"/>
        <rect x="0" y="0" width="40" height="8" fill="black"/>
        <rect x="32" y="8" width="8" height="32" fill="black"/>
        <use href="#frame"/>
      </symbol>
      <symbol id="diamond" viewBox="0 0 40 40">
        <rect width="40" height="40" fill="white"/>
        <polygon points="20,6 34,20 20,34 6,20" fill="black"/>
        <use href="#frame"/>
      </symbol>
      <symbol id="triplet" viewBox="0 0 40 40">
        <rect width="40" height="40" fill="white"/>
        <rect x="6"  y="0" width="4" height="40" fill="black"/>
        <rect x="18" y="0" width="4" height="40" fill="black"/>
        <rect x="30" y="0" width="4" height="40" fill="black"/>
        <use href="#frame"/>
      </symbol>
      <symbol id="quad-UL" viewBox="0 0 40 40">
        <rect width="40" height="40" fill="white"/>
        <rect x="0" y="0" width="20" height="20" fill="black"/>
        <use href="#frame"/>
      </symbol>
      <symbol id="quad-LR" viewBox="0 0 40 40">
        <rect width="40" height="40" fill="white"/>
        <rect x="20" y="20" width="20" height="20" fill="black"/>
        <use href="#frame"/>
      </symbol>
    </defs>
  </svg>

  <div id="stage"></div>
</div>

<script>
const ROWS=20, COLS=20, CELL=40, GAP=6;
const TARGETS_PER_ROW = Array.from({length:ROWS},(_,i)=> i%2===0?7:5);
const TARGET_ID = "target";
const DIST = ["bar-right","bar-top","bar-bottom","bar-center","diag-fwd","diag-back",
              "tri-edges","top-and-right","diamond","triplet","quad-UL","quad-LR"];
const ns="http://www.w3.org/2000/svg";

function R(n){return Math.floor(Math.random()*n)}
function shuffle(a){for(let i=a.length-1;i>0;i--){const j=R(i+1);[a[i],a[j]]=[a[j],a[i]]}return a}

function build(){
  const W = COLS*CELL + (COLS-1)*GAP + 20;
  const H = ROWS*CELL + (ROWS-1)*GAP + 20;
  const svg = document.createElementNS(ns,"svg");
  svg.setAttribute("xmlns",ns);
  svg.setAttribute("viewBox",`0 0 ${W} ${H}`);
  svg.setAttribute("width",W); svg.setAttribute("height",H);
  svg.setAttribute("shape-rendering","crispEdges");

  const bg = document.createElementNS(ns,"rect");
  bg.setAttribute("x",0); bg.setAttribute("y",0);
  bg.setAttribute("width",W); bg.setAttribute("height",H);
  bg.setAttribute("fill","#fff"); svg.appendChild(bg);
  const g = document.createElementNS(ns,"g"); g.setAttribute("transform","translate(10,10)"); svg.appendChild(g);

  for(let r0=0;r0<ROWS;r0++){
    const idx = shuffle([...Array(COLS).keys()]);
    const slots = new Set(idx.slice(0,TARGETS_PER_ROW[r0]));
    for(let c=0;c<COLS;c++){
      const use = document.createElementNS(ns,"use");
      use.setAttribute("href","#"+(slots.has(c)?TARGET_ID:DIST[R(DIST.length)]));
      use.setAttribute("x", c*(CELL+GAP));
      use.setAttribute("y", r0*(CELL+GAP));
      use.setAttribute("width", CELL);
      use.setAttribute("height", CELL);
      g.appendChild(use);
    }
  }
  const stage=document.getElementById('stage'); stage.innerHTML=""; stage.appendChild(svg);
}

function downloadSVG(){
  const svg=document.querySelector('#stage svg');
  const blob=new Blob([svg.outerHTML],{type:'image/svg+xml;charset=utf-8'});
  const a=document.createElement('a'); a.href=URL.createObjectURL(blob);
  a.download='folha-simbolos-40x40-metade-esquerda.svg'; a.click(); URL.revokeObjectURL(a.href);
}

document.getElementById('regen').onclick=build;
document.getElementById('download').onclick=downloadSVG;
build();
</script>
